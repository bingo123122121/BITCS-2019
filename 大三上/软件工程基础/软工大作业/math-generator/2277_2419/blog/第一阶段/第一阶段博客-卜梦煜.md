# 四则运算训练系统博客

## 目录

1. 接口设计
   1. 需求分析
   2. 类的组织
   3. Information Hiding
   4. Interface Design
   5. Loose Coupling
2. 设计实现
   1. Model
   2. Controller
   3. View
3. 单元测试
4. 性能测试
5. 心得感悟



## 1. 接口设计

### 1.1 需求分析

根据用户需求，我们确定项目采用MVC架构。

Model部分负责搭建数据结构，不仅应当定义数据和题目的存储方式，也应当将生成和存储方式封装起来，只通过接口将已经生成好的表达式及相应答案传给外界。

Controller部分是model部分和view部分的“桥梁”，它负责根据用户的操作进行相应的题目生成抽取答案判断等功能，并将结果反馈给用户。

View部分负责参数处理和将结果呈现给用户。在第一阶段中，用户与系统进行交互的接口是命令行，通过输入命令行参数进行题目生成，题目抽取和答题。因此我们将这些用户直接交互的功能封装到view部分中。

### 1.2 类的组织

Model部分设置五个类

* Number类：存储数据结构。
* Calculator类：封装四则运算方式。
* Node类：存储表达式数的节点。
* Formula类“存储表达式及相关操作。
* File类：存储文件及相关操作。

Controller类部分设置三个类

* ProblemGenerate类：生成1000道不重复的四则运算题目。
* ProblemExtraction类：抽取指定数量的题目。
* AnswerJudge类：判断答案是否正确。

View部分设置一个类

* cmd类：识别用户参数并进行相应的反馈。

### 1.3 Information Hiding

信息隐藏主要通过类及类方法的封装实现。

1. 将分数四则运算单独封装在运算类中，在进行分数四则运算时，只需调用相应函数即可。
2. 将表达式及相关操作单独封装在一个类中，在生成题目时不仅生成表达式，也自动求得其答案和哈希值，使其他类和对象只知道题目的中序表示字符串、答案和哈希值，而无需知道表达式的实现方式。

### 1.4 Interface Design

MVC三个部分之间需要通过接口交换信息：

* model部分和controller部分：交换题目的中序表示字符串、答案和哈希值
* controller部分和view部分：交换控制命令和答案判断结果

我们对这些需要交换的信息设置相应的接口并尽量保证接口在非必要时只读。

### 1.5 Loose Coupling

通过信息隐藏和接口设计，我们使得model部分，controller部分，view部分之间交换的信息达到最简，从而降低了项目的耦合度。

## 2. 设计实现

我负责完成Model模块的File类、Controller模块、View模块的编码。

### 2.1 Model

File类封装文件读写操作，提供的主要的外界接口为表达式类写入文件与从文件中读出表达式与答案。首先约定题目文件的存储格式：每行一道题目，每道题目格式为“表达式 分子 分母”。对表达式类写入文件的方法，输入为Formula*，以保证接口功能的完备性。对于从文件中读出表达式的方法，为保证为“随机题目”，因此先生成随机数数组。考虑到文件读写操作相对较耗时，因此读出操作为“一次性读出”，以尽可能减少文件操作的时间。

### 2.2 Controller

Controller模块包括ProblemGenerate类、ProblemExtraction类、AnswerJudge类。

1. ProblemGenerate类负责生成1000道不重复的题目，并写入文件。该类调用Model模块的Formula类生成表达式，获取答案；调用File类将题目写入文件。
2. ProblemExtraction类负责抽取指定数量的题目，并提供表达式变量与答案变量的查询接口。该类首先调用私有方法生成指定范围的、去重的、有序的随机数组作为抽取的题目序号，然后调用Model模块的File类读出指定序号的题目，将表达式与答案分别存储在私有变量中。外部类查询时，可调用表达式和答案的get方法获取表达式和答案。
3. AnswerJudge类负责存储标准答案，判断用户答案的正确性。该类从ProblemExtraction类中读出题目答案，并转化为Number类存储在私有变量中。接受用户输入，并调用Number类中重载的“==”运算符判断用户答案正确性。

### 2.3 View

View模块包括cmd类。

cmd类负责对用户输入的命令行内容的解析和运行。首先对用户输入解析，拆分出各个参数；然后对参数解析，根据参数类型调用Controller中对应的类，完成用户指定的各个操作；同时利用返回值记录运行状态，以控制程序的运行过程。

## 3. 单元测试

单元测试主要是对类中方法特别是接口进行测试，并采用vs2019自带的代码覆盖率工具查看代码覆盖率。

## 4. 性能测试

软件测试包括性能测试、软件质量测试，这些都采用vs2019自带的代码测试工具实现，测试结果见测试文档。

## 5. 心得感悟

第一阶段是难度最高的一个阶段。一方面，我们对于软件开发的过程并没有实操经验，很多时候都是根据书本内容或网上查阅的资料完成相关的设计和文档；过程上的不熟练也导致时间把控上的问题，第一阶段花费时间较长。另一方面，第一阶段需要全面考虑许多因素，既要考虑到设计的科学性，又要考虑代码的面向对象特性。如Model类的设计与封装，其中表达式的存储方式、生成方式，结点类的表示，基本数的表示等，都是经过两人查阅资料和多次讨论才确定下来的。
