# 四则运算训练系统博客

## 目录

1. 接口设计
   1. 需求分析
   2. 类的组织
   3. Information Hiding
   4. Interface Design
   5. Loose Coupling
2. 设计实现
   1. Model
   2. Controller
   3. View
3. 单元测试
4. 性能测试
5. 心得感悟



## 1. 接口设计

### 1.1 需求分析

根据用户需求，我们确定项目采用MVC架构。

Model部分负责搭建数据结构，不仅应当定义数据和题目的存储方式，也应当将生成和存储方式封装起来，只通过接口将已经生成好的表达式及相应答案传给外界。

Controller部分是model部分和view部分的“桥梁”，它负责根据用户的操作进行相应的题目生成抽取答案判断等功能，并将结果反馈给用户。

View部分负责参数处理和将结果呈现给用户。在第一阶段中，用户与系统进行交互的接口是命令行，通过输入命令行参数进行题目生成，题目抽取和答题。因此我们将这些用户直接交互的功能封装到view部分中。

### 1.2 类的组织

Model部分设置五个类

* Number类：存储数据结构。
* Calculator类：封装四则运算方式。
* Node类：存储表达式数的节点。
* Formula类“存储表达式及相关操作。
* File类：存储文件及相关操作。

Controller类部分设置三个类

* ProblemGenerate类：生成1000道不重复嗯四则运算题目。
* ProblemExtraction类：抽取指定数量的题目。
* AnswerJudge类：判断答案是否正确。

View部分设置一个类

* cmd类：识别用户参数并进行相应的反馈。

### 1.3 Information Hiding

信息隐藏主要通过类及类方法的封装实现。

1. 将分数四则运算单独封装在运算类中，在进行分数四则运算时，只需调用相应函数即可。
2. 将表达式及相关操作单独封装在一个类中，在生成题目时不仅生成表达式，也自动求得其答案和哈希值，使其他类和对象只知道题目的中序表示字符串、答案和哈希值，而无需知道表达式的实现方式。

### 1.4 Interface Design

MVC三个部分之间需要通过接口交换信息：

* model部分和controller部分：交换题目的中序表示字符串、答案和哈希值
* controller部分和view部分：交换控制命令和答案判断结果

我们对这些需要交换的信息设置相应的接口并尽量保证接口在非必要时只读。

### 1.5 Loose Coupling

通过信息隐藏和接口设计，我们使得model部分，controller部分，view部分之间交换的信息达到最简，从而降低了项目的耦合度。

## 2. 设计实现

### 2.1 Model

1. 需求要求可以支持分数运算，因此我们采用**分数形式存储所有运算数**，其中整数当做分母为1的分数，将分数单独设计为Number类，包含分子和分母。运算数还必须包含特定方法，例如重写==运算符判断两个分数是否相等。
2. 由于系统运算数表示方法是人为定义，因此需要**重写四则运算方法与分数类对应**，从而设定运算类，它包含运算数的加减乘除四则运算，并将运算结果分子分母约分。四则运算采用人工计算分数表达式的方式，如通分相加等；约分采用辗转相除算法。
3. 我们采用**树状结构存储表达式**，树根为符号，其左右子树为参加运算的子表达式树或运算数。规定叶子结点只能为运算数且左右子树为空。采用树状结构存储，既有利于产生表达式，又有利于生成中缀表达式——中序遍历树即可。树的结点有两种类型——符号结点和运算数结点，但我们用同一种结点存储，将其内容置为**union类型**，可以**存储char或Number类型但同一时间只能存储一种类型**，并单独置flag属性区分节点类型。
4. 我们**采用随机生成结点扩展表达式树**的方法。每次生成树结点时，有1/2概率生成运算数结点，1/2概率生成符号结点，但是若当前树已经有10个符号了则一定生成运算数结点。若是符号结点，又随机生成加减乘除运算符，并递归生成其左右子树结点。
5. 随机数方式可以保证生成的式子足够随机，却不能避免”相等“或”交换后相等“的情况，因此需要对表达式进行查重，我们**采用计算表达式哈希值的方式查重**，统计每个表达式的运算数、符号及它们分别出现的次数计算哈希值，哈希值相等则判断为表达式一样。这种方法虽然会排除掉本不”相等“的式子，但避免了遍历树，提高了效率。
6. 表达式求值采用中序遍历树的方法实现。

### 2.2 Controller

队友实现

### 2.3 View

队友实现

## 3. 单元测试

单元测试主要是对类中方法特别是接口进行测试，并采用vs2019自带的代码覆盖率工具查看代码覆盖率。

## 4. 性能测试

软件测试包括性能测试、软件质量测试，这些都采用vs2019自带的代码测试工具实现，测试结果见测试文档。

## 5. 心得感悟

第一阶段是一个“从无到有“的过程，因此所花的时间最长，考虑的因素最多。在进行模型搭建时，最大的技术难点就是表达式的查重问题。如果一一比对所有表达式的表达式树则会比较麻烦，因此我们采用计算哈希值的方式进行查重。这种方法虽然会排除掉原本不”相等“的式子，但避免了遍历树，提高了效率。
